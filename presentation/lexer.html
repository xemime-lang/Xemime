<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Lexer</title>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        .node {
            position: absolute;
            padding: 10px;
            z-index: 1;
        }
        .gray {
            background-color: #999999;
            color: white;
            border: 3px solid #CCCCCC;
        }
        .green {
            background-color: #669966;
            color: white;
            border: 3px solid #99BB99;
        }
        .blue {
            background-color: #6699CC;
            color: white;
            border: 3px solid #99CCFF;
        }
        .aqua {
            background-color: #336699;
            color: white;
            border: 3px solid #114477;
        }
    </style>
</head>
<body>
<script>

const _source = 'green',
    _entity = 'gray',
    _node = 'aqua',
    _arg = 'blue';

function /*Element*/ addBlock ( /*String*/ text = 'Node', /*String*/ color = 'gray' ) {
    let element = document.createElement('div');
    element.classList.add('node');
    element.classList.add(color);
    element.innerHTML = text;
    document.body.appendChild(element);
    return element;
}

let _if = addBlock('if', _source),
    _2 = addBlock('2', _entity),
    _greater = addBlock('＞', _source),
    _1 = addBlock('1', _entity),
    _lb = addBlock('{', _source),
    _println = addBlock('println', _source),
    _dollar = addBlock('$', _source),
    _1e = addBlock('1', _entity),
    _add = addBlock('＋', _source),
    _2e = addBlock('2', _entity),
    _mul = addBlock('＊', _source),
    _3 = addBlock('3', _entity),
    _rb = addBlock('}', _source);

_if.style.top = '200px';
_if.style.left = '200px';
_2.style.top = '200px';
_2.style.left = '240px';
_greater.style.top = '200px';
_greater.style.left = '280px';
_1.style.top = '200px';
_1.style.left = '325px';
_lb.style.top = '200px';
_lb.style.left = '365px';
_println.style.top = '253px';
_println.style.left = '240px';
_dollar.style.top = '253px';
_dollar.style.left = '320px';
_1e.style.top = '253px';
_1e.style.left = '359px';
_add.style.top = '253px';
_add.style.left = '399px';
_2e.style.top = '253px';
_2e.style.left = '444px';
_mul.style.top = '253px';
_mul.style.left = '484px';
_3.style.top = '253px';
_3.style.left = '529px';
_rb.style.top = '306px';
_rb.style.left = '200px';

let progress = 0;

let procedures = [];

let nodes = {};

// `if` を見つけて If Node の生成を開始する
procedures.push(() => {
    _if.style.backgroundColor = '#CC6666';
    _if.style.border = '3px solid #FF9999';
    let element = addBlock('If Node', _node);
    element.style.top = '412px';
    element.style.left = '200px';
    nodes['if'] = element;
});

// 論理式を発見して BinExpr Node の生成を開始する
procedures.push(() => {
    _if.style.backgroundColor = '#669966';
    _if.style.border = '3px solid #99BB99';
    _2.style.backgroundColor = '#CC6666';
    _2.style.border = '3px solid #FF9999';
    _greater.style.backgroundColor = '#CC6666';
    _greater.style.border = '3px solid #FF9999';
    _1.style.backgroundColor = '#CC6666';
    _1.style.border = '3px solid #FF9999';
    let element = addBlock('BinExpr Node', _node);
    element.style.top = '465px';
    element.style.left = '200px';
    nodes['binExpr'] = element;
});

// > 演算子を発見して BinExpr Node を更新する
procedures.push(() => {
    _2.style.backgroundColor = '#999999';
    _2.style.border = '3px solid #CCCCCC';
    _1.style.backgroundColor = '#999999';
    _1.style.border = '3px solid #CCCCCC';
    let element = addBlock('＞', _arg);
    element.style.top = '465px';
    element.style.left = '330px';
    nodes['greater'] = element;
    nodes['binExpr'].style.width = '160px';
});

// `2` を発見して BinExpr Node を更新する
procedures.push(() => {
    _greater.style.backgroundColor = '#669966';
    _greater.style.border = '3px solid #99CC99';
    _2.style.backgroundColor = '#CC6666';
    _2.style.border = '3px solid #FF9999';
    let element = addBlock('2', _arg);
    element.style.top = '465px';
    element.style.left = '375px';
    nodes['2'] = element;
    nodes['binExpr'].style.width = '200px';
});

// `1` を発見して BinExpr Node を更新する
procedures.push(() => {
    _2.style.backgroundColor = '#999999';
    _2.style.border = '3px solid #CCCCCC';
    _1.style.backgroundColor = '#CC6666';
    _1.style.border = '3px solid #FF9999';
    let element = addBlock('1', _arg);
    element.style.top = '465px';
    element.style.left = '415px';
    nodes['1'] = element;
    nodes['binExpr'].style.width = '240px';
});

// If Node が BinExpr Node を取り込む
procedures.push(() => {
    _1.style.backgroundColor = '#999999';
    _1.style.border = '3px solid #CCCCCC';
    _lb.style.backgroundColor = '#CC6666';
    _lb.style.border = '3px solid #FF9999';
    nodes['if'].style.padding = '15px';
    nodes['if'].style.width = '335px';
    nodes['binExpr'].style.top = '417px';
    nodes['binExpr'].style.left = '290px';
    nodes['greater'].style.top = '417px';
    nodes['greater'].style.left = '420px';
    nodes['1'].style.top = '417px';
    nodes['1'].style.left = '505px';
    nodes['2'].style.top = '417px';
    nodes['2'].style.left = '465px';
});

// `println` を発見する
procedures.push(() => {
    _lb.style.backgroundColor = '#669966';
    _lb.style.border = '3px solid #99CC99';
    _println.style.backgroundColor = '#CC6666';
    _println.style.border = '3px solid #FF9999';
    let element = addBlock('println', _arg);
    element.style.top = '475px';
    element.style.left = '200px';
    nodes['println'] = element;
});

// 関数呼び出しを発見する
procedures.push(() => {
    _println.style.backgroundColor = '#669966';
    _println.style.border = '3px solid #99CC99';
    _dollar.style.backgroundColor = '#CC6666';
    _dollar.style.border = '3px solid #FF9999';
    nodes['println'].style.left = '325px'; // '280px';
    let element = addBlock('Funcall Node', _node);
    element.style.top = '475px';
    element.style.left = '200px';
    nodes['funcall'] = element;
    nodes['funcall'].style.width = '190px'; // '145px';
    nodes['funcall'].style.zIndex = '1';
    nodes['println'].style.zIndex = '2';
});

// 式 `1 + 2 * 3` を発見して BinExpr Node の生成を開始する
procedures.push(() => {
    _dollar.style.backgroundColor = '#669966';
    _dollar.style.border = '3px solid #99CC99';
    _1e.style.backgroundColor = '#CC6666';
    _1e.style.border = '3px solid #FF9999';
    _add.style.backgroundColor = '#CC6666';
    _add.style.border = '3px solid #FF9999';
    _2e.style.backgroundColor = '#CC6666';
    _2e.style.border = '3px solid #FF9999';
    _mul.style.backgroundColor = '#CC6666';
    _mul.style.border = '3px solid #FF9999';
    _3.style.backgroundColor = '#CC6666';
    _3.style.border = '3px solid #FF9999';
    let element = addBlock('BinExpr Node', _node);
    element.style.top = '528px';
    element.style.left = '200px';
    nodes['binExpr2'] = element;
});

// + 演算子を発見して BinExpr Node を更新する
procedures.push(() => {
    _1e.style.backgroundColor = '#999999';
    _1e.style.border = '3px solid #CCCCCC';
    _2e.style.backgroundColor = '#999999';
    _2e.style.border = '3px solid #CCCCCC';
    _mul.style.backgroundColor = '#669966';
    _mul.style.border = '3px solid #99CC99';
    _3.style.backgroundColor = '#999999';
    _3.style.border = '3px solid #CCCCCC';
    let element = addBlock('＋', _arg);
    element.style.top = '528px';
    element.style.left = '330px';
    nodes['add'] = element;
    nodes['binExpr2'].style.width = '160px';
});

procedures.push(() => {
    _add.style.backgroundColor = '#669966';
    _add.style.border = '3px solid #99CC99';
    _1e.style.backgroundColor = '#CC6666';
    _1e.style.border = '3px solid #FF9999';
    let element = addBlock('1', _arg);
    element.style.top = '528px';
    element.style.left = '375px';
    nodes['1e'] = element;
    nodes['binExpr2'].style.width = '200px';
});

procedures.push(() => {
    _1e.style.backgroundColor = '#999999';
    _1e.style.border = '3px solid #CCCCCC';
    _2e.style.backgroundColor = '#CC6666';
    _2e.style.border = '3px solid #FF9999';
    _mul.style.backgroundColor = '#CC6666';
    _mul.style.border = '3px solid #FF9999';
    _3.style.backgroundColor = '#CC6666';
    _3.style.border = '3px solid #FF9999';
    let element = addBlock('BinExpr Node', _node);
    element.style.top = '581px';
    element.style.left = '200px';
    nodes['binExpr3'] = element;
});

procedures.push(() => {
    _2e.style.backgroundColor = '#999999';
    _2e.style.border = '3px solid #CCCCCC';
    _3.style.backgroundColor = '#999999';
    _3.style.border = '3px solid #CCCCCC';
    let element = addBlock('＊', _arg);
    element.style.top = '581px';
    element.style.left = '330px';
    nodes['mul'] = element;
    nodes['binExpr3'].style.width = '160px';
});

procedures.push(() => {
    _mul.style.backgroundColor = '#669966';
    _mul.style.border = '3px solid #99CC99';
    _2e.style.backgroundColor = '#CC6666';
    _2e.style.border = '3px solid #FF9999';
    let element = addBlock('2', _arg);
    element.style.top = '581px';
    element.style.left = '375px';
    nodes['2e'] = element;
    nodes['binExpr3'].style.width = '200px'
});

procedures.push(() => {
    _2e.style.backgroundColor = '#999999';
    _2e.style.border = '3px solid #CCCCCC';
    _3.style.backgroundColor = '#CC6666';
    _3.style.border = '3px solid #FF9999';
    let element = addBlock('3', _arg);
    element.style.top = '581px';
    element.style.left = '415px';
    nodes['3'] = element;
    nodes['binExpr3'].style.width = '240px';
});

procedures.push(() => {
    _3.style.backgroundColor = '#999999';
    _3.style.border = '3px solid #CCCCCC';
    nodes['binExpr2'].style.padding = '15px';
    nodes['binExpr3'].style.top = '533px';
    nodes['add'].style.top = '533px';
    nodes['1e'].style.top = '533px';
    nodes['binExpr3'].style.left = '415px';
    nodes['binExpr2'].style.width = '460px';
    nodes['mul'].style.top = '533px';
    nodes['mul'].style.left = '545px';
    nodes['2e'].style.top = '533px';
    nodes['2e'].style.left = '590px';
    nodes['3'].style.top = '533px';
    nodes['3'].style.left = '630px';
});

procedures.push(() => {
    nodes['funcall'].style.padding = '20px';
    nodes['println'].style.top = '485px';
    nodes['println'].style.left = '340px';
    nodes['binExpr2'].style.top = '480px';
    nodes['binExpr2'].style.left = '420px';
    nodes['funcall'].style.width = '680px';
    nodes['add'].style.top = '485px';
    nodes['add'].style.left = '555px';
    nodes['1e'].style.top = '485px';
    nodes['1e'].style.left = '600px';
    nodes['binExpr3'].style.top = '485px';
    nodes['binExpr3'].style.left = '640px';
    nodes['mul'].style.top = '485px';
    nodes['mul'].style.left = '770px';
    nodes['2e'].style.top = '485px';
    nodes['2e'].style.left = '815px';
    nodes['3'].style.top = '485px';
    nodes['3'].style.left = '855px';
});

procedures.push(() => {
    nodes['if'].innerHTML = 'If Node<br><br><br>then<br><br>';
    nodes['funcall'].style.top = '485px';
    nodes['funcall'].style.left = '270px';
    nodes['if'].style.width = '770px';
    nodes['println'].style.top = '495px';
    nodes['println'].style.left = '410px';
    nodes['binExpr2'].style.top = '490px';
    nodes['binExpr2'].style.left = '490px';
    nodes['add'].style.top = '495px';
    nodes['add'].style.left = '625px';
    nodes['1e'].style.top = '495px';
    nodes['1e'].style.left = '670px';
    nodes['binExpr3'].style.top = '495px';
    nodes['binExpr3'].style.left = '710px';
    nodes['mul'].style.top = '495px';
    nodes['mul'].style.left = '840px';
    nodes['2e'].style.top = '495px';
    nodes['2e'].style.left = '885px';
    nodes['3'].style.top = '495px';
    nodes['3'].style.left = '925px';
});

procedures.push(() => {
    nodes['if'].style.backgroundColor = '#CC66CC';
    nodes['if'].style.border = '3px solid #FF99FF';
});

procedures.push(() => {
    nodes['binExpr'].style.backgroundColor = '#CC66CC';
    nodes['binExpr'].style.border = '3px solid #FF99FF';
});

procedures.push(() => {
    nodes['2'].style.backgroundColor = '#999999';
    nodes['2'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['1'].style.backgroundColor = '#999999';
    nodes['1'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['binExpr'].style.backgroundColor = '#999999';
    nodes['binExpr'].style.border = '3px solid #CCCCCC';
    nodes['greater'].parentNode.removeChild(nodes['greater']);
    nodes['2'].parentNode.removeChild(nodes['2']);
    nodes['1'].parentNode.removeChild(nodes['1']);
    nodes['binExpr'].innerHTML = 'T';
    nodes['binExpr'].style.width = '10px';
    nodes['funcall'].style.backgroundColor = '#CC66CC';
    nodes['funcall'].style.border = '3px solid #FF99FF';
});

procedures.push(() => {
    nodes['println'].style.backgroundColor = '#999999';
    nodes['println'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['binExpr2'].style.backgroundColor = '#CC66CC';
    nodes['binExpr2'].style.border = '3px solid #FF99FF';
});

procedures.push(() => {
    nodes['1e'].style.backgroundColor = '#999999';
    nodes['1e'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['binExpr3'].style.backgroundColor = '#CC66CC';
    nodes['binExpr3'].style.border = '3px solid #FF99FF';
});

procedures.push(() => {
    nodes['2e'].style.backgroundColor = '#999999';
    nodes['2e'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['3'].style.backgroundColor = '#999999';
    nodes['3'].style.border = '3px solid #CCCCCC';
});

procedures.push(() => {
    nodes['binExpr3'].style.backgroundColor = '#999999';
    nodes['binExpr3'].style.border = '3px solid #CCCCCC';
    nodes['binExpr3'].innerHTML = '6';
    nodes['binExpr3'].style.width = '10px'
    nodes['mul'].parentNode.removeChild(nodes['mul']);
    nodes['2e'].parentNode.removeChild(nodes['2e']);
    nodes['3'].parentNode.removeChild(nodes['3']);
    nodes['binExpr2'].style.width = '230px';
    nodes['funcall'].style.width = '450px';
    nodes['if'].style.width = '540px';
});

procedures.push(() => {
    nodes['binExpr2'].style.backgroundColor = '#999999';
    nodes['binExpr2'].style.border = '3px solid #CCCCCC';
    nodes['binExpr2'].innerHTML = '7';
    nodes['binExpr2'].style.width = '10px';
    nodes['add'].parentNode.removeChild(nodes['add']);
    nodes['1e'].parentNode.removeChild(nodes['1e']);
    nodes['binExpr3'].parentNode.removeChild(nodes['binExpr3']);
    nodes['funcall'].style.width = '230px';
    nodes['if'].style.width = '320px';
});

procedures.push(() => {
    nodes['funcall'].style.backgroundColor = '#999999';
    nodes['funcall'].style.border = '3px solid #CCCCCC';
    nodes['println'].parentNode.removeChild(nodes['println']);
    nodes['binExpr2'].parentNode.removeChild(nodes['binExpr2']);
    nodes['funcall'].innerHTML = '7';
    nodes['funcall'].style.width = '10px';
    nodes['if'].style.width = '105px';
});

procedures.push(() => {
    nodes['binExpr'].parentNode.removeChild(nodes['binExpr']);
    nodes['funcall'].parentNode.removeChild(nodes['funcall']);
    nodes['if'].style.backgroundColor = '#999999';
    nodes['if'].style.border = '3px solid #CCCCCC';
    nodes['if'].innerHTML = '7';
    nodes['if'].style.width = '10px';
});

document.addEventListener('keyup', (e) => {
    if (progress >= procedures.length) return;
    if (e.key === 'Enter') {
        procedures[progress]();
        progress ++;
    }
});

    /*let elements = document.getElementsByClassName('node');
    let x, y;

    for (let i = 0; i < elements.length; i++) {
        elements[i].addEventListener('mousedown', mdown, false);
        elements[i].addEventListener('touchstart', mdown, false);
        elements[i].style.top = i * 60 + "px";
        elements[i].style.zIndex = i;
    }

    function mdown(e) {
        if (e.keyCode === 32) return;
        var event;
        this.classList.add("drag");
        if (e.type === "mousedown") {
            event = e;
        } else {
            event = e.changedTouches[0];
        }

        x = event.pageX - this.offsetLeft;
        y = event.pageY - this.offsetTop;

        document.body.addEventListener("mousemove", mmove, false);
        document.body.addEventListener("touchmove", mmove, false);
    }

    function mmove(e) {
        let drag = document.getElementsByClassName('drag')[0];
        var event;

        if (e.type === "mousemove") {
            event = e;
        } else {
            event = e.changedTouches[0];
        }

        e.preventDefault();

        drag.style.top = event.pageY - y + "px";
        drag.style.left = event.pageX - x + "px";

        drag.addEventListener("mouseup", mup, false);
        document.body.addEventListener("mouseleave", mup, false);
        drag.addEventListener("touchend", mup, false);
        document.body.addEventListener("touchleave", mup, false);
    }

    function mup(e) {
        let drag = document.getElementsByClassName("drag")[0];

        document.body.removeEventListener("mousemove", mmove, false);
        drag.removeEventListener("mouseup", mup, false);
        document.body.removeEventListener("touchmove", mmove, false);
        drag.removeEventListener("touched", mup, false);

        drag.classList.remove("drag");
    }*/

</script>
</body>
</html>
